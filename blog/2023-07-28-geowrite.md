# 2023年7月28日

GeoWorks は RISC OS や Ring にでも移植したほうが良さそうだな。結局、 GEOS は保守コストを考えるとすべて書き直しになるから頭が痛くなるね。あきらめて [PipeDream](https://croftnuisk.co.uk/coltsoft/pipedream) でもと魔剣マガサス(ステンレス鋼)ですね。

## GeoWrite

主なファイル構成は .asm (ソースコード), .def (定数などの宣言を記したインクルードファイル), .ui (ユーザインタフェース) かな。

使われている API や ESP のディレクティブなど調べておきたいので、ちょっと読み始めます。といってもナンモワカラン。翻訳始めた頃を思い出すなあ。ま、そんなものです。

### 8086 / 80186 命令

特に変なのはない。たぶん他のプロセッサとの移植性なんて多少は考えていたのだろう(もともとC64出身のソフトだけど)。
後で洗い出して書き直します(※は80186命令などなど)。

Esp のディレクティブは i386 に対応しているようだけど、 opcodes.h あたりを眺める限りは使えるのかは不明です。

命令セット参考: https://en.wikipedia.org/wiki/X86_instruction_listings

```
add, dec, and, not, or, rcr, shr
call, ret, retn
cmp, jc, jcxz, jz, jnz, je, jne
test,
lahf, sahf
mov, lea, push, pop, inc, sub, 
repe, stc
```

以下は未調査

```
uses,　cmpdw
pushf, popf
local, les, lds
ja, je, jle
proc, endp
loop,
clr,
ornf

mul
.enter
.leave
ends
endm
```

### ユーザ定義マクロ命令

[geos.def](https://github.com/bluewaysw/pcgeos/blob/9672d033f192a4fd5103103bf385cc8cd58c48b7/Include/geos.def) に記載されています。

このマクロ定義は80186以降でなければ正常に動作しません。たしか、8086で80186のソフトウェアエミュレーションを行うものがあったと記憶していますが。これがGEOSで使えるかは不明です (8086搭載機ならばV30に換装してしまうのでしょうけど)

```
movdw,
mov_tr, segmov, tst
```

### ライブラリ

定義については [write.gp](https://github.com/bluewaysw/pcgeos/blob/9672d033f192a4fd5103103bf385cc8cd58c48b7/Appl/GeoWrite/write.gp#L46C1-L46C1) あたりを参照のこと。

*	geos
*	ui
*	[text](https://github.com/bluewaysw/pcgeos/tree/master/Library/Text)
*	[grobj](https://github.com/bluewaysw/pcgeos/tree/master/Library/GrObj)
*	[ruler](https://github.com/bluewaysw/pcgeos/tree/master/Library/Ruler)
*	[bitmap](https://github.com/bluewaysw/pcgeos/tree/master/Library/Bitmap)
*	spool
*	[impex](https://github.com/bluewaysw/pcgeos/tree/master/Library/Impex)
*	spell
*	styles
*	[spline](https://github.com/bluewaysw/pcgeos/tree/master/Library/Spline)
*	[color](https://github.com/bluewaysw/pcgeos/tree/master/Library/Color)

カーネルやライブラリのソースコードは Library ディレクトリにある(geos と ui ライブラリだけどこにあるか不明...)。迷ったらそちらを参照。

完全移植するなら GeoWriteよりライブラリのほうが解析は手間かもしれない。いやさ、フルアセンブラだぜ。最終的にモダン言語に書き直すとはいえ、やはりその解読作業は慣れるまで時間がかかる。

### まったくわかんないよ。
本当に。ただ、いままでの翻訳経験なんかを応用しているだけ。

* 単語の抽出(出現頻度)
* 意味や機能の調査
* 概念の理解
* 自然言語への翻訳

プログラミングとは逆のことをしている。
